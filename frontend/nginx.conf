events {
    worker_connections  1024;
}

http {
    proxy_set_header Cookie "";
    include /etc/nginx/mime.types;
    large_client_header_buffers 16 2M;  # 16 buffer x 2MB = 32MB max
    client_header_buffer_size 2M;      # İlk buffer 2MB
    client_max_body_size 0;            # Body size limit kaldır (0 = unlimited)
    proxy_buffer_size 2M;
    proxy_buffers 16 2M;

    # Prevent port being added to redirects
    port_in_redirect off;

    server {
        listen 90;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # Security headers
        add_header Content-Security-Policy "default-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; img-src * data:; font-src *; connect-src *; frame-src *; object-src 'none';" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Strict-Transport-Security "max-age=2365200000; includeSubDomains; preload" always;

        # Handle exact match for /backoffice-frontend (without trailing slash)
        location = /backoffice-frontend {
            try_files /backoffice-frontend/index.html =404;
        }

        location /backoffice-frontend/ {
            root /usr/share/nginx/html;
            index index.html;

            location = /backoffice-frontend/assets/ {
                return 302 /backoffice-frontend/not-found;
            }
            location = /backoffice-frontend/public/ {
                return 302 /backoffice-frontend/not-found;
            }

            try_files $uri $uri/ /backoffice-frontend/index.html;
        }

        # Block other paths to avoid accidental serving
        location / {
            return 404;
        }
    }



    server {
        listen 443;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # Security headers
        add_header Content-Security-Policy "default-src *; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; img-src * data:; font-src *; connect-src *; frame-src *; object-src 'none';" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;

        # Handle exact match for /backoffice-frontend (without trailing slash)
        location = /backoffice-frontend {
            # Use internal redirect instead of 301 to avoid port issues
            try_files /backoffice-frontend/index.html =404;
        }

        location /backoffice-frontend/ {
            root /usr/share/nginx/html;
            index index.html;
            gzip_static on;
            
            location = /backoffice-frontend/assets/ {
                return 302 /backoffice-frontend/not-found;
            }
            location = /backoffice-frontend/public/ {
                return 302 /backoffice-frontend/not-found;
            }

            try_files $uri $uri/ /backoffice-frontend/index.html;
        }

        # Block all other routes
        location / {
            return 404;
        }
    }
}